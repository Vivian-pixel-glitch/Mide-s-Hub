<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto:wght@300;400;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="../othercsspages/Sign in.css">
</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="../index.html">
        <img class="logo" src="../images/plogo.png" alt="">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
        aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <p>> login</p>
        </ul>
      </div>
    </div>
  </nav>

  <h1>Sign Up</h1>
  <div class="form-container">
    <div id="signUpForm">
      <div class="mb-3">
        <label class="form-label">First Name</label>
        <input type="text" class="form-control" id="firstName">
      </div>
      <div class="mb-3">
        <label class="form-label">Last Name</label>
        <input type="text" class="form-control" id="lastName">
      </div>
      <div class="mb-3">
        <label class="form-label">Email Address</label>
        <input type="email" class="form-control" id="email">
      </div>
      <div class="mb-3">
        <label class="form-label">Password</label>
        <input type="password" placeholder="At least 9 characters including an Uppercase and Number"
          class="form-control" id="password">
      </div>
      <div class="mb-3">
        <label class="form-label">Confirm Password</label>
        <input type="password" class="form-control" id="confirmPassword">
      </div>
      <button type="submit" class="btn btn-primary" id="buttonSubmit" >Sign Up!</button>

      <p class="logintext">Already have an account?
        <button class="loginbtn">
          <a href="../otherhtmlpages/login.html">Login</a>
        </button>
      </p>
    </form>

    <p id="error-message" class="error-message"></p>
    <a href=""></a>




    <script type="module">
      // Import Firebase SDKs
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
      import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";
      import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
  
      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyD-j9c2hqNfo28lhraks3uM3d39HlJkYJo",
  authDomain: "randy-s-place-3a443.firebaseapp.com",
  projectId: "randy-s-place-3a443",
  storageBucket: "randy-s-place-3a443.firebasestorage.app",
  messagingSenderId: "880015781726",
  appId: "1:880015781726:web:20ca6749a9f09b6113a9cf",
  measurementId: "G-EQF5K05PPD"
      };
  
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
  
      // Form submission event listener
        document.getElementById("buttonSubmit").addEventListener("click", async function (event) {
          event.preventDefault(); // Prevent page reload
  
          // Get user input
          const firstName = document.getElementById("firstName").value.trim();
          const lastName = document.getElementById("lastName").value.trim();
          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value.trim();
          const confirmPassword = document.getElementById("confirmPassword").value.trim();
          const errorMessage = document.getElementById("error-message");
  
          // Validate inputs
          let passwordREGEX = /^(?=.*[A-Z])(?=.*\d).{9,}$/;
  
          if (!firstName || !lastName || !email || !password || !confirmPassword) {
            errorMessage.textContent = "Please fill all fields!";
            errorMessage.style.display = "block";
            return;
          }
  
          if (!email.includes("@") || !email.includes(".")) {
            alert("Please enter a valid email address.");
            return;
          }
  
          // if (!passwordREGEX.test(password)) {
          //   alert("Password must be at least 9 characters long, include an uppercase letter, and a number.");
          //   return;
          // }
  
          if (password !== confirmPassword) {
            alert("Passwords do not match.");
            return;
          }
  
          try {
            // Create user with Firebase Authentication
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;
  
            // Save user details in Firestore using UID
            await setDoc(doc(db, "users", user.uid), {
              firstName: firstName,
              lastName: lastName,
              email: email,
              uid: user.uid,
              createdAt: new Date()
            });
  
            alert("Sign-up successful! Welcome, " + firstName);
            window.location.href = "../otherhtmlpages/shop.html"; // Redirect after signup
          } catch (error) {
            errorMessage.textContent = error.message;
            errorMessage.style.display = "block";
          }
        });





      //   createUserWithEmailAndPassword(auth, email, password)
      //     .then((userCredential) => {
      //       alert("Sign-up successful! Welcome, " + userCredential.user.firstName);
      //       window.location.href = "../otherhtmlpages/shop.html"; // Redirect after signup
      //     })
      //     .catch((error) => {
      //       document.getElementById("error-message").textContent = error.message;
      //     });
      // });

      // onAuthStateChanged(auth, (user) => {
      //   if (user) {
      //     console.log("User is logged in: ", user.email);
      //   } else {
      //     console.log("No user is logged in");
      //   }
      // });

    </script>
</body>

</html>